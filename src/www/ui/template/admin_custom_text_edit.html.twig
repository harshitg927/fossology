{# SPDX-FileCopyrightText: Â© 2025 Harshit Gandhi <gandhiharshit716@gmail.com>

   SPDX-License-Identifier: FSFAP
#}
{% extends "include/base.html.twig" %}

{% block content %}

<form method="post">
  <input type="hidden" name="{{ updateParam }}" value="1">
  {% if cp_pk %}
    <input type="hidden" name="cp_pk" value="{{ cp_pk }}">
  {% endif %}
  
  <table>
    {% if isEdit and created_date is not empty %}
      <tr>
        <td>{{ 'Created Date'|trans }}:</td>
        <td><span>{{ created_date|e }}</span></td>
      </tr>    
    {% endif %}
    
    <tr>
      <td valign="top">{{ 'Associated Licenses'|trans }}:</td>
      <td>
        <select name="{{ licensesParam }}[]" id="licenseSelect" multiple style="width: 500px; height: 150px;">
          {% for key, value in licenseOptions %}
            {% if key != '' %}
              <option value="{{ key }}" 
                {% for selectedLicense in selectedLicenses %}
                  {% if selectedLicense.rf_pk == key %}selected="selected"{% endif %}
                {% endfor %}>
                {{ value|e }}
              </option>
            {% endif %}
          {% endfor %}
        </select>
        <br/>
        <small>{{ 'Hold Ctrl/Cmd key to select multiple licenses. Use the search box to find licenses quickly.'|trans }}</small>
      </td>
    </tr>
    
    <tr>
      <td valign="top">{{ 'Text'|trans }}:</td>
      <td><textarea name="{{ textParam }}" cols="120" rows="10" required>{{ text|e }}</textarea></td>
    </tr>
    
    <tr>
      <td valign="top">{{ 'Acknowledgement'|trans }}:</td>
      <td><textarea name="{{ acknowledgementParam }}" cols="120" rows="6">{{ acknowledgement|e }}</textarea></td>
    </tr>
    
    <tr>
      <td valign="top">{{ 'Comments'|trans }}:</td>
      <td><textarea name="{{ commentsParam }}" cols="120" rows="6">{{ comments|e }}</textarea></td>
    </tr>
    
    <tr>
      <td>{{ 'User ID'|trans }}:</td>
      <td><input type="input" name="{{ userFkParam }}" value="{{ user_fk|e }}"/></td>
    </tr>
    
    <tr>
      <td>{{ 'Group ID'|trans }}:</td>
      <td><input type="input" name="{{ groupFkParam }}" value="{{ group_fk|e }}"/></td>
    </tr>
    
    <tr>
      <td>{{ 'Active'|trans }}:</td>
      <td><input type="checkbox" name="{{ isActiveParam }}"{% if is_active is not defined or is_active %} checked="checked"{% endif %}/></td>
    </tr>
  </table>
  
  <input type="submit" value="{{ isEdit ? 'Update'|trans : 'Save'|trans }}"/>
</form>  

{% endblock %}

{% block foot %}
  {{ parent() }}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  
  <script type="text/javascript">
    $(document).ready(function() {
      $('#licenseSelect').select2({
        placeholder: '{{ "Select licenses..."|trans }}',
        allowClear: true,
        width: '100%',
        matcher: function(params, data) {
          // If there are no search terms, return all of the data
          if ($.trim(params.term) === '') {
            return data;
          }

          // Do not display the item if there is no 'text' property
          if (typeof data.text === 'undefined') {
            return null;
          }

          // `params.term` should be the term that is used for searching
          // `data.text` is the text that is displayed for the data object
          if (data.text.toLowerCase().indexOf(params.term.toLowerCase()) > -1) {
            var modifiedData = $.extend({}, data, true);
            return modifiedData;
          }

          // Return `null` if the term should not be displayed
          return null;
        }
      });
    });
  </script>
{% endblock %}