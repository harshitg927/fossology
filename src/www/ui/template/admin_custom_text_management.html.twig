{# SPDX-FileCopyrightText: Â© 2025 Harshit Gandhi <gandhiharshit716@gmail.com>

   SPDX-License-Identifier: FSFAP
#}
{% extends "include/base.html.twig" %}

{% block content %}

<table class="semibordered" id="customPhrasesTable" width="100%" cellpadding="0">
  <thead>
    <tr>
      <th width="5%"></th>
      <th width="25%"></th>
      <th width="15%"></th>
      <th width="15%"></th>
      <th width="10%"></th>
      <th width="10%"></th>
      <th width="10%"></th>
      <th width="5%"></th>
      <th width="5%"></th>
    </tr>
  </thead>
</table>

<br/><br/>
<div style="text-align:center;">
  <a href="{{ formAction }}&edit=0" class="buttonLink">{{ 'Add New Custom Text'|trans }}</a>
</div>

{% endblock %}

{% block foot %}
  {{ parent() }}
  <script src="scripts/jquery.dataTables.min.js" type="text/javascript"></script>
  <script src="scripts/jquery.dataTables.select.js" type="text/javascript"></script>
  <script type="text/javascript">
    function createBrowseTable() {

    tableColumns = [
      {"sTitle": "{{ "Edit"|trans }}", "sClass": "center", "bSearchable": false},
      {"sTitle": "{{ "Text"|trans }}", "sClass": "left", "bSearchable": true},
      {"sTitle": "{{ "Acknowledgement"|trans }}", "sClass": "left", "bSearchable": true},
      {"sTitle": "{{ "Comments"|trans }}", "sClass": "left", "bSearchable": true},
      {"sTitle": "{{ "Licenses"|trans }}", "sClass": "center", "bSearchable": true},
      {"sTitle": "{{ "Created By"|trans }}", "sClass": "center", "bSearchable": true},
      {"sTitle": "{{ "Created Date"|trans }}", "sClass": "center", "bSearchable": false},
      {"sTitle": "{{ "Status"|trans }}", "sClass": "center", "bSearchable": false},
      {"sTitle": "{{ "Actions"|trans }}", "sClass": "center", "bSearchable": false}
    ];

    tableSorting = [ [6, "desc"] ]; // Sort by created date descending

    dataTableConfig =
        {
          "aoColumns": tableColumns,
          "aaSorting": tableSorting,
          "iDisplayLength": 20,
          "aaData": {{ aaData }},
          "sPaginationType": "listbox",
          "bStateSave": true
        };

      var otable = $('#customPhrasesTable').dataTable(dataTableConfig);
      return otable;
    }

    function deletePhrase(phraseId) {
      if (confirm("{{ 'Are you sure you want to delete this custom text? This action cannot be undone.'|trans }}")) {
        $.ajax({
          url: "?mod=admin_custom_text_management&action=delete",
          type: "POST",
          data: { id: phraseId },
          dataType: "json",
          success: function (data) {
            if (data.error) {
              alert("Error: " + data.error);
            } else {
              alert(data.message || "{{ 'Custom text deleted successfully!'|trans }}");
              window.location.reload();
            }
          },
          error: function (xhr, status, error) {
            alert("{{ 'Error deleting text:'|trans }} " + error);
          }
        });
      }
    }

    function togglePhraseStatus(phraseId, currentStatus) {
      $.ajax({
        url: "?mod=admin_custom_text_management&action=toggle",
        type: "POST",
        data: { id: phraseId, status: currentStatus ? 0 : 1 },
        dataType: "json",
        success: function (data) {
          if (data.error) {
            alert("Error: " + data.error);
          } else {
            window.location.reload();
          }
        },
        error: function (xhr, status, error) {
          alert("{{ 'Error toggling status:'|trans }} " + error);
        }
      });
    }
    
    $(document).ready(function () {
      createBrowseTable();
    });
    
  </script>
{% endblock %} 